{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CityAir Logs - Alertas </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="{% static 'styles/styles.css' %}" rel="stylesheet">

  <style>
      /* Estilo personalizado para centrar vertical y horizontalmente */
      .toast-container.center-screen {
          /* Fija la posici贸n en el centro de la pantalla */
          top: 50%;
          left: 50%;
          /* Mueve el contenedor a la izquierda y arriba por la mitad de su propio tama帽o */
          transform: translate(-50%, -50%);
          z-index: 1080; /* Asegura que est茅 sobre todo lo dem谩s */
      }
  </style>

</head>
<body>

  {% include 'partials/navbar/navbar.html' %} 

  <div class="content">
    <h1 class="mb-4">Generador de Alertas por Perfil</h1>

    <div class="row g-4">
        
        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person-running"></i> Deportistas</h5>
                </div>
                <div class="card-body d-grid gap-2">
                    <button class="btn btn-danger" onclick="showToast('Deportistas', '', 'danger')"> Alerta M谩xima</button>
                    <button class="btn btn-warning" onclick="showToast('Deportistas', '锔', 'warning')">锔 Precauci贸n (ICA > 100)</button>
                    <button class="btn btn-success" onclick="showToast('Deportistas', '', 'success')"> Condiciones ptimas</button>
                    <button class="btn btn-secondary" onclick="showToast('Deportistas', '', 'secondary')"> Riesgo Ozono</button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-person-heart"></i> Tercera Edad</h5>
                </div>
                <div class="card-body d-grid gap-2">
                    <button class="btn btn-warning" onclick="showToast('Tercera Edad', '锔', 'warning')">锔 Aire Regular</button>
                    <button class="btn btn-danger" onclick="showToast('Tercera Edad', '', 'danger')"> Alerta Sanitaria</button>
                    <button class="btn btn-success" onclick="showToast('Tercera Edad', '', 'success')"> Buena Calidad</button>
                    <button class="btn btn-secondary" onclick="showToast('Tercera Edad', '', 'secondary')"> Riesgo Alto</button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="bi bi-lungs"></i> Enf. Respiratorias</h5>
                </div>
                <div class="card-body d-grid gap-2">
                    <button class="btn btn-danger" onclick="showToast('Respiratorias', '', 'danger')"> PM2.5 Alto (N95)</button>
                    <button class="btn btn-warning" onclick="showToast('Respiratorias', '锔', 'warning')">锔 Exposici贸n Prolongada</button>
                    <button class="btn btn-secondary" onclick="showToast('Respiratorias', '', 'secondary')"> Condiciones Cr铆ticas</button>
                    <button class="btn btn-success" onclick="showToast('Respiratorias', '', 'success')"> Aire Limpio</button>
                </div>
            </div>
        </div>

    </div>
    
    <div class="mt-5">
        <h4><i class="bi bi-chat-dots"></i> Mensajes Generales</h4>
        <div class="d-flex flex-wrap gap-3">
            <button class="btn btn-outline-primary" onclick="showToast('Generales', '', 'info')"> ICA de Hoy (132)</button>
            <button class="btn btn-outline-info" onclick="showToast('Generales', '', 'info')"> Incremento Ozono</button>
            <button class="btn btn-outline-secondary" onclick="showToast('Generales', '', 'secondary')"> Pr贸ximo Pico</button>
            <button class="btn btn-outline-dark" onclick="showToast('Generales', '', 'dark')"> Mantener Ventanas</button>
        </div>
    </div>
  </div>

  <div aria-live="polite" aria-atomic="true" class="toast-container position-fixed center-screen">
    <div id="alert-toast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="7000">
        <div class="d-flex">
            <div class="toast-body" id="toast-body-content">
                </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
  </div>

  <audio id="alert-sound" src="{% static 'sound/alert_sound.mp3' %}" preload="auto"></audio>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // -------------------------------------
    // LGICA DE DATOS Y TOAST (SIN CAMBIOS)
    // -------------------------------------
    
    const ALERTS_DATA = {
        Deportistas: {
            '': "La calidad del aire es mala. Evita entrenar al aire libre entre las 11:00 y 17:00 hrs.",
            '锔': "ndice de calidad del aire superior a 100. Se recomienda reducir la intensidad del ejercicio.",
            '': "Condiciones 贸ptimas: entrena con seguridad al aire libre.",
            '': "Alta concentraci贸n de ozono. Prefiere entrenamiento bajo techo hoy."
        },
        'Tercera Edad': {
            '锔': "La calidad del aire es regular. Evite salir sin necesidad y mantenga ventanas cerradas.",
            '': "Alerta sanitaria: se recomienda permanecer en interiores y usar purificador de aire.",
            '': "Buena calidad del aire: disfrute actividades al aire libre con precauci贸n.",
            '': "Riesgo alto: consulte a su m茅dico si presenta dificultad para respirar."
        },
        Respiratorias: {
            '': "Alta presencia de part铆culas PM2.5. Use cubrebocas tipo N95 si sale al exterior.",
            '锔': "Evite la exposici贸n prolongada. Lleve su inhalador o tratamiento preventivo.",
            '': "Condiciones cr铆ticas: permanezca en interiores y evite cualquier esfuerzo f铆sico.",
            '': "Aire limpio: riesgo m铆nimo para su salud respiratoria."
        },
        Generales: {
            '': "Hoy el 铆ndice de calidad del aire es de 132 (Mala). Revise las recomendaciones seg煤n su perfil.",
            '': "Se espera incremento de ozono en las pr贸ximas horas. Programe sus actividades temprano.",
            '': "Pr贸ximo pico de contaminaci贸n estimado a las 15:00 hrs.",
            '': "Mantenga cerradas puertas y ventanas para evitar ingreso de contaminantes."
        }
    };

    const alertToast = document.getElementById('alert-toast');
    const toastBody = document.getElementById('toast-body-content');
    const alertSound = document.getElementById('alert-sound');
    
    const toastBootstrap = bootstrap.Toast.getOrCreateInstance(alertToast);

    function showToast(profile, statusIcon, bsColor) {
        const message = ALERTS_DATA[profile][statusIcon] || "Mensaje de alerta no encontrado.";
        
        // Reproducir Sonido
        alertSound.pause();
        alertSound.currentTime = 0;
        alertSound.play().catch(error => {
            console.warn("No se pudo reproducir el sonido:", error);
        });

        // Aplicar estilos y contenido din谩mico
        alertToast.className = 'toast align-items-center text-white border-0';
        alertToast.classList.add(`text-bg-${bsColor}`);
        
        toastBody.innerHTML = `<strong>${statusIcon} ${profile}:</strong> ${message}`;

        // Mostrar el Toast
        toastBootstrap.show(); 
    }
  </script>
</body>
</html>